Object subclass: #BoardSquare	instanceVariableNames: 'position player board'	classVariableNames: ''	poolDictionaries: ''	category: 'SnakesAndLadders'!!BoardSquare commentStamp: 'on 3/14/2006 19:27' prior: 0!Responsibilities:- Remember position in the board- Keep track of any players on this square- Send on any players passing through- Displays itself with its position and any player who might be on it, e.g., [7 Jack]!!BoardSquare methodsFor: 'initialize-release' stamp: 'oscarnierstrasz 9/8/2011 12:48'!invariant	^ ((board notNil		and: [ position notNil ])		and: [ position >= 0 ])		and: [ position <= board lastPosition]! !!BoardSquare methodsFor: 'initialize-release' stamp: 'onierstrasz 8/18/2016 15:51'!initializePosition: aNumber board: aBoard 	position := aNumber.	board := aBoard! !!BoardSquare methodsFor: 'printing' stamp: 'OscarNierstrasz 8/18/2016 15:59:27'!printOn: aStream	aStream nextPutAll: '[', position printString, self contents, ']'.! !!BoardSquare methodsFor: 'printing' stamp: 'on 3/14/2006 17:18'!contents	^ self isOccupied		ifTrue: [ ' ', player asString ]		ifFalse: [ '' ]! !!BoardSquare methodsFor: 'playing' stamp: 'on 3/15/2006 15:26'!backwardBy: squares 	^ squares = 0 		ifTrue: [self destination]		ifFalse: 			[self isFirstSquare 				ifTrue: [self nextSquare forwardBy: squares - 1]				ifFalse: [self previousSquare backwardBy: squares - 1]]! !!BoardSquare methodsFor: 'playing' stamp: 'on 3/15/2006 15:26'!destination	^ self! !!BoardSquare methodsFor: 'playing' stamp: 'on 3/14/2006 16:32'!previousSquare	self assert: self isFirstSquare not.	^ board at: position - 1! !!BoardSquare methodsFor: 'playing' stamp: 'on 3/14/2006 16:32'!nextSquare	self assert: self isLastSquare not.	^ board at: position + 1! !!BoardSquare methodsFor: 'playing' stamp: 'on 3/15/2006 15:43'!landHere: aPlayer	^ self isOccupied		ifTrue: [ board firstSquare landHere: aPlayer ]		ifFalse: [ player := aPlayer. self ]! !!BoardSquare methodsFor: 'playing' stamp: 'on 3/14/2006 16:14'!remove: aPlayer	self assert: player = aPlayer.	player := nil.! !!BoardSquare methodsFor: 'playing' stamp: 'on 3/18/2006 11:43'!forwardBy: squares	self assert: self invariant.	^ squares = 0 		ifTrue: [self destination]		ifFalse: 			[self isLastSquare 				ifFalse: [self nextSquare forwardBy: squares - 1]				ifTrue: [self previousSquare backwardBy: squares - 1]]! !!BoardSquare methodsFor: 'testing' stamp: 'on 3/20/2006 10:17'!isLastSquare	^ position = board lastPosition! !!BoardSquare methodsFor: 'testing' stamp: 'on 3/14/2006 16:40'!isOccupied	^ player notNil! !!BoardSquare methodsFor: 'testing' stamp: 'on 3/14/2006 17:03'!position	^ position! !!BoardSquare methodsFor: 'testing' stamp: 'on 3/14/2006 16:12'!isFirstSquare	^ position = 1! !Object subclass: #Die	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'SnakesAndLadders'!!Die commentStamp: 'on 3/14/2006 19:06' prior: 0!Responsibilities:- Yields a random number from 1 to 6 ;-)!!Die methodsFor: 'playing' stamp: 'on 3/14/2006 15:41'!roll	^ (1 to: 6) atRandom! !BoardSquare subclass: #FirstSquare	instanceVariableNames: 'players'	classVariableNames: ''	poolDictionaries: ''	category: 'SnakesAndLadders'!!FirstSquare commentStamp: 'on 3/14/2006 19:06' prior: 0!Responsibilities:- Allows multiple players to be added or removed [normal squares can only hold a single player]!!FirstSquare methodsFor: 'playing' stamp: 'on 3/14/2006 16:15'!remove: aPlayer	self assert: (players includes: aPlayer).	players remove: aPlayer.! !!FirstSquare methodsFor: 'testing' stamp: 'on 3/18/2006 11:10'!isOccupied	^ players size > 0! !!FirstSquare methodsFor: 'printing' stamp: 'on 3/14/2006 15:35'!contents	^ players inject: '' into:			[ :list :each | list , ' ', each asString ]! !!FirstSquare methodsFor: 'initialize-release' stamp: 'on 3/15/2006 15:29'!landHere: aPlayer	players add: aPlayer.! !!FirstSquare methodsFor: 'initialize-release' stamp: 'on 3/14/2006 15:30'!initialize	players := OrderedCollection new.! !Object subclass: #GamePlayer	instanceVariableNames: 'name square'	classVariableNames: ''	poolDictionaries: ''	category: 'SnakesAndLadders'!!GamePlayer commentStamp: 'onierstrasz 8/18/2016 14:23' prior: 0!Responsibilities:- Keep track of your name and your current sqaure- Move when requested!!GamePlayer methodsFor: 'playing' stamp: 'on 3/18/2006 15:21'!moveTo: aSquare	self leaveCurrentSquare.	square := aSquare landHere: self.! !!GamePlayer methodsFor: 'playing' stamp: 'on 3/23/2006 09:04'!moveWith: aDie	| roll destination |	self assert: self invariant.	roll := aDie roll.	destination := square forwardBy: roll.	self moveTo: destination.	^ name, ' rolls ', roll asString, ' and lands at ', square asString! !!GamePlayer methodsFor: 'initialize-release' stamp: 'on 3/18/2006 12:49'!setName: aName	name := aName.! !!GamePlayer methodsFor: 'initialize-release' stamp: 'on 3/18/2006 12:08'!invariant	^ square notNil		and: [ name notNil ]! !!GamePlayer methodsFor: 'printing' stamp: 'OscarNierstrasz 8/18/2016 15:59:27'!printOn: aStream	aStream nextPutAll: name! !!GamePlayer methodsFor: 'testing' stamp: 'on 3/14/2006 17:03'!position	^ square position! !!GamePlayer methodsFor: 'testing' stamp: 'on 3/15/2006 14:57'!name	^ name! !!GamePlayer methodsFor: 'private' stamp: 'on 3/14/2006 15:53'!leaveCurrentSquare	square notNil ifTrue: [ square remove: self ].! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!GamePlayer class	instanceVariableNames: ''!!GamePlayer class methodsFor: 'instance creation' stamp: 'on 3/18/2006 12:48'!named: aName	^ self new setName: aName! !BoardSquare subclass: #LadderSquare	instanceVariableNames: 'forward'	classVariableNames: ''	poolDictionaries: ''	category: 'SnakesAndLadders'!!LadderSquare commentStamp: 'onierstrasz 8/18/2016 14:22' prior: 0!Responsibilities:- Transport a player who lands here forward to another square!!LadderSquare methodsFor: 'playing' stamp: 'on 3/15/2006 15:26'!destination	^ self forwardBy: forward! !!LadderSquare methodsFor: 'printing' stamp: 'OscarNierstrasz 8/18/2016 15:59:27'!printOn: aStream	super printOn: aStream.	aStream nextPutAll: forward asString, '+>'.! !!LadderSquare methodsFor: 'initialize-release' stamp: 'onierstrasz 8/18/2016 15:50'!initializeForward: aNumber	forward := aNumber.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!LadderSquare class	instanceVariableNames: ''!!LadderSquare class methodsFor: 'instance creation' stamp: 'onierstrasz 8/18/2016 15:50'!forward: number	^ self new initializeForward: number! !Die subclass: #LoadedDie	instanceVariableNames: 'roll'	classVariableNames: ''	poolDictionaries: ''	category: 'SnakesAndLadders'!!LoadedDie commentStamp: 'on 3/17/2006 10:50' prior: 0!For testing purposes. When rolled, a loaded die returns a fixed value.!!LoadedDie methodsFor: 'playing' stamp: 'on 3/18/2006 15:25'!roll: aNumber	self assert: ((1 to: 6) includes: aNumber).	roll := aNumber.! !!LoadedDie methodsFor: 'playing' stamp: 'on 3/18/2006 15:24'!roll	self assert: roll notNil.	^ roll! !TestCase subclass: #MetaclassHierarchyTest	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'SnakesAndLadders'!!MetaclassHierarchyTest commentStamp: 'on 3/19/2006 11:33' prior: 0!Demonstrate the relationship between classes and metaclasses!!MetaclassHierarchyTest methodsFor: 'running' stamp: 'onierstrasz 8/18/2016 14:29'!testHierarchy	"The class hierarchy"	self assert: SnakeSquare superclass equals: BoardSquare.	self assert: BoardSquare superclass equals: Object.	self assert: Object superclass superclass equals: nil.	"The parallel metaclass hierarchy"	self assert: SnakeSquare class name equals: 'SnakeSquare class'.	self assert: SnakeSquare class superclass equals: BoardSquare class.	self assert: BoardSquare class superclass equals: Object class.	self assert: Object class superclass superclass equals: Class.	self assert: Class superclass equals: ClassDescription.	self assert: ClassDescription superclass equals: Behavior.	self assert: Behavior superclass equals: Object.	"The Metaclass hierarchy"	self assert: SnakeSquare class class equals: Metaclass.	self assert: BoardSquare class class equals: Metaclass.	self assert: Object class class equals: Metaclass.	self assert: Class class class equals: Metaclass.	self assert: ClassDescription class class equals: Metaclass.	self assert: Behavior class class equals: Metaclass.	self assert: Metaclass superclass equals: ClassDescription.	"The fixpoint"	self assert: Metaclass class class equals: Metaclass! !BoardSquare subclass: #SnakeSquare	instanceVariableNames: 'back'	classVariableNames: ''	poolDictionaries: ''	category: 'SnakesAndLadders'!!SnakeSquare commentStamp: 'onierstrasz 8/18/2016 14:22' prior: 0!Responsibilities:- Transport a player who lands here back to another square!!SnakeSquare methodsFor: 'initialize-release' stamp: 'onierstrasz 8/18/2016 15:50'!initializeBack: aNumber	back := aNumber.! !!SnakeSquare methodsFor: 'printing' stamp: 'OscarNierstrasz 8/18/2016 15:59:27'!printOn: aStream	aStream nextPutAll: '<-', back asString.	super printOn: aStream.! !!SnakeSquare methodsFor: 'playing' stamp: 'on 3/15/2006 15:26'!destination	^ self backwardBy: back! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!SnakeSquare class	instanceVariableNames: ''!!SnakeSquare class methodsFor: 'instance creation' stamp: 'onierstrasz 8/18/2016 15:50'!back: number	^ self new initializeBack: number! !Object subclass: #SnakesAndLadders	instanceVariableNames: 'players squares turn die over'	classVariableNames: ''	poolDictionaries: ''	category: 'SnakesAndLadders'!!SnakesAndLadders commentStamp: 'onierstrasz 8/18/2016 14:28' prior: 0!Play a game of Snakes and Ladders, and output the result to the Transcript:	SnakesAndLadders example playToEnd .	SnakesAndLadders examples playToEnd .Note that the game requires no user interaction (except to roll a die, which is done by the game).!!SnakesAndLadders methodsFor: 'testing' stamp: 'on 3/14/2006 16:22'!turn	^ turn! !!SnakesAndLadders methodsFor: 'testing' stamp: 'on 3/18/2006 15:04'!isNotOver	^ self isOver not! !!SnakesAndLadders methodsFor: 'testing' stamp: 'on 3/18/2006 15:04'!isOver	^ over! !!SnakesAndLadders methodsFor: 'testing' stamp: 'on 3/14/2006 16:43'!firstSquare	^ squares first! !!SnakesAndLadders methodsFor: 'testing' stamp: 'on 3/14/2006 16:54'!currentPlayer	^ players at: turn! !!SnakesAndLadders methodsFor: 'testing' stamp: 'on 3/14/2006 16:30'!at: position	^ squares at: position! !!SnakesAndLadders methodsFor: 'testing' stamp: 'on 3/14/2006 16:59'!lastPosition	^ squares size! !!SnakesAndLadders methodsFor: 'initialize-release' stamp: 'oscarnierstrasz 9/8/2011 12:48'!invariant	"Should also check that snakes and ladders lead to ordinary squares, and do not bounce	past the beginning or end of the board."	^ ((squares size > 1		and: [players size > 1])		and: [turn >= 1])		and: [turn <= players size]! !!SnakesAndLadders methodsFor: 'initialize-release' stamp: 'onierstrasz 8/18/2016 15:51'!add: aSquare 	squares add: aSquare.	aSquare initializePosition: squares size board: self! !!SnakesAndLadders methodsFor: 'initialize-release' stamp: 'on 3/16/2006 11:30'!reset	die := Die new.	turn := 1.	over := false.	players do: [:each | each moveTo: self firstSquare ].	self assert: self invariant.! !!SnakesAndLadders methodsFor: 'initialize-release' stamp: 'on 3/20/2006 10:16'!initialize	super initialize.	die := Die new.	squares := OrderedCollection new.	players := OrderedCollection new.	turn := 1.	over := false.! !!SnakesAndLadders methodsFor: 'initialize-release' stamp: 'on 3/18/2006 12:10'!join: aPlayer	players add: aPlayer.	aPlayer moveTo: self firstSquare.! !!SnakesAndLadders methodsFor: 'playing' stamp: 'on 3/14/2006 16:21'!upDateTurn	turn := 1 + (turn\\players size).! !!SnakesAndLadders methodsFor: 'playing' stamp: 'on 3/18/2006 15:01'!playToEnd	"SnakesAndLadders example playToEnd"	"Transcript closeAllViews."	(Transcript dependents select: #isSystemWindow) do: #close.	Transcript open.	Transcript		show: self asString;		cr;		cr.	[self isNotOver] whileTrue: 			[Transcript				show: self playOneMove asString;				cr.			Transcript				show: self asString;				cr;				cr]! !!SnakesAndLadders methodsFor: 'playing' stamp: 'on 3/14/2006 17:10'!checkResult	^ self currentPlayer position = self lastPosition		ifTrue: [			over := true.			' -- ', self currentPlayer asString, ' wins!!'			]		ifFalse: [ '' ]! !!SnakesAndLadders methodsFor: 'playing' stamp: 'on 5/17/2006 16:49'!playOneMove	| result |	self assert: self invariant.	^ self isOver 		ifTrue: ['The game is over!!']		ifFalse: 			[result := (self currentPlayer moveWith: die) , self checkResult.			self upDateTurn.			result]! !!SnakesAndLadders methodsFor: 'printing' stamp: 'OscarNierstrasz 8/18/2016 15:59:27'!printOn: aStream	squares do: [:each | each printOn: aStream].! !!SnakesAndLadders methodsFor: 'accessors' stamp: 'on 3/15/2006 13:29'!setDie: aDie	"For testing only. Can play the game with a loaded die."	die := aDie.! !!SnakesAndLadders methodsFor: 'accessors' stamp: 'on 3/15/2006 15:01'!players	"needed for testing"	^ players! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!SnakesAndLadders class	instanceVariableNames: ''!!SnakesAndLadders class methodsFor: 'documentation' stamp: 'on 10/28/2007 13:51'!example	"self example playToEnd"	^ (self new)		add: FirstSquare new;		add: (LadderSquare forward: 4);		add: BoardSquare new;		add: BoardSquare new;		add: BoardSquare new;		add: BoardSquare new;		add: (LadderSquare forward: 2);		add: BoardSquare new;		add: BoardSquare new;		add: BoardSquare new;		add: (SnakeSquare back: 6);		add: BoardSquare new;		join: (GamePlayer named: 'Jack');		join: (GamePlayer named: 'Jill');		yourself! !!SnakesAndLadders class methodsFor: 'documentation' stamp: 'on 10/28/2007 13:51'!example2	"self example2 playToEnd"	^ (self new)		add: FirstSquare new;		add: BoardSquare new;		add: (LadderSquare forward: 4);		add: BoardSquare new;		add: BoardSquare new;		add: (SnakeSquare back: 2);		add: BoardSquare new;		add: (LadderSquare forward: 3);		add: BoardSquare new;		add: BoardSquare new;		add: (SnakeSquare back: 4);		add: BoardSquare new;		add: BoardSquare new;		join: (GamePlayer named: 'Jack');		join: (GamePlayer named: 'Jill');		yourself! !TestCase subclass: #SnakesAndLaddersTest	instanceVariableNames: 'eg loadedDie jack jill'	classVariableNames: ''	poolDictionaries: ''	category: 'SnakesAndLadders'!!SnakesAndLaddersTest commentStamp: 'on 3/15/2006 13:24' prior: 0!Play a rigged game and check the results.!!SnakesAndLaddersTest methodsFor: 'running' stamp: 'onierstrasz 8/18/2016 14:30'!testStartPosition	self assert: eg lastPosition equals: 12.	self assert: eg isNotOver.	self assert: eg currentPlayer equals: jack.	self assert: eg firstSquare isFirstSquare.	self assert: eg firstSquare isLastSquare not.	self assert: eg firstSquare position equals: 1.	self assert: eg firstSquare isOccupied.	self assert: (eg at: eg lastPosition) isFirstSquare not.	self assert: (eg at: eg lastPosition) isLastSquare.	self assert: (eg at: eg lastPosition) position equals: 12.	self assert: (eg at: eg lastPosition) isOccupied not.	self assert: jack name equals: 'Jack'.	self assert: jill name equals: 'Jill'.	self assert: jack position equals: 1.	self assert: jill position equals: 1! !!SnakesAndLaddersTest methodsFor: 'running' stamp: 'on 3/16/2006 09:58'!setUp	eg := self example.	loadedDie := LoadedDie new.	eg setDie: loadedDie.	jack := eg players first.	jill := eg players last.! !!SnakesAndLaddersTest methodsFor: 'running' stamp: 'on 3/16/2006 09:58'!example	^ SnakesAndLadders example! !!SnakesAndLaddersTest methodsFor: 'running' stamp: 'onierstrasz 8/18/2016 14:29'!testExample	self assert: eg currentPlayer equals: jack.	loadedDie roll: 1.	eg playOneMove.	self assert: jack position equals: 6.	self assert: eg currentPlayer equals: jill.	loadedDie roll: 5.	eg playOneMove.	self assert: jill position equals: 1.	self assert: eg currentPlayer equals: jack.	loadedDie roll: 5.	eg playOneMove.	self assert: jack position equals: 5.	self assert: eg currentPlayer equals: jill.	loadedDie roll: 4.	eg playOneMove.	self assert: jill position equals: 1.	self assert: eg currentPlayer equals: jack.	loadedDie roll: 6.	eg playOneMove.	self assert: jack position equals: 5.	self assert: eg currentPlayer equals: jill.	loadedDie roll: 6.	eg playOneMove.	self assert: jill position equals: 9.	self assert: eg currentPlayer equals: jack.	loadedDie roll: 5.	eg playOneMove.	self assert: jack position equals: 10.	self assert: eg currentPlayer equals: jill.	loadedDie roll: 5.	eg playOneMove.	self assert: jill position equals: 1.	self assert: eg currentPlayer equals: jack.	loadedDie roll: 2.	eg playOneMove.	self assert: jack position equals: 12.	self assert: eg isOver! !SnakesAndLaddersTest subclass: #SnakesAndLaddersTest2	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'SnakesAndLadders'!!SnakesAndLaddersTest2 commentStamp: 'on 3/17/2006 10:50' prior: 0!Some tests for a second example.!!SnakesAndLaddersTest2 methodsFor: 'running' stamp: 'onierstrasz 8/18/2016 14:30'!testExample	self assert: jack name equals: 'Jack'.	self assert: jill name equals: 'Jill'.	self assert: jack position equals: 1.	self assert: jill position equals: 1.	self assert: eg currentPlayer equals: jack.	loadedDie roll: 1.	eg playOneMove.	self assert: jack position equals: 2.	self assert: eg currentPlayer equals: jill.	loadedDie roll: 2.	eg playOneMove.	self assert: jill position equals: 7.	self assert: eg currentPlayer equals: jack.	loadedDie roll: 3.	eg playOneMove.	self assert: jack position equals: 5.	self assert: eg currentPlayer equals: jill.	loadedDie roll: 1.	eg playOneMove.	self assert: jill position equals: 7.	self assert: eg currentPlayer equals: jack.	loadedDie roll: 2.	eg playOneMove.	self assert: jack position equals: 1.	self assert: eg currentPlayer equals: jill.	loadedDie roll: 5.	eg playOneMove.	self assert: jill position equals: 12.	self assert: eg currentPlayer equals: jack.	loadedDie roll: 6.	eg playOneMove.	self assert: jack position equals: 7.	self assert: eg currentPlayer equals: jill.	loadedDie roll: 1.	eg playOneMove.	self assert: jill position equals: 13.	self assert: eg isOver! !!SnakesAndLaddersTest2 methodsFor: 'running' stamp: 'on 3/16/2006 09:59'!example	^ SnakesAndLadders example2! !